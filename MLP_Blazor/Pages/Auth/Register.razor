@page "/auth/register"
@layout MainLayout


@inject HttpClient Client
@inject IMapper _mapper 
@inject NavigationManager NavManager


<div class="container-fluid pt-5 d-flex justify-content-center">
    <div class="row g-3">
        <div class="form-control col-md-6">
            <h4>Register</h4>
            <EditForm Model="model" OnValidSubmit="RegisterUser">

                <DataAnnotationsValidator />
                <ValidationSummary />

                <div class="col-md-12">
                    <label class="label">Email</label>
                    <input type="text" placeholder="Enter Email" @bind-value="model.Email" />
                </div>
                <div class="col-md-12">
                    <label class="label">Password</label>
                    <input type="password" placeholder="Enter Password" @bind-value="model.Password" />
                </div>
                <div class="col-md-12">
                    <label class="label">Confirm Password</label>
                    <input type="password" placeholder="Confrim Password" @bind-value="model.PasswordConfirm" />
                </div>
                @if (!string.IsNullOrWhiteSpace(message))
                {
                    <div class="alert alert-info col-md-12">@message <span @onclick="HideMessage">x</span></div>
                }
                <div class="col-md-12">
                    <label class="label">First Name</label>
                    <input type="text" placeholder="Enter First Name" @bind-value="model.FirstName" />
                </div>
                <div class="col-md-12">
                    <label class="label">Last Name</label>
                    <input type="text" placeholder="Enter Last Name" @bind-value="model.LastName" />
                </div>
                <div class="col-md-12">
                    <label class="label">Teacher</label>
                    <input type="checkbox" @bind-value="model.IsTeacher" />
                </div>

                <br />

                <div class="col-12 d-flex justify-content-center">
                    <button class="btn-register" style="" type="submit" disabled="@isBusy">Register</button>
                </div>
                <div class="col-12 d-flex justify-content-center" style="font-size: small">
                    Already have an account?
                </div>
                <div class="col-12 d-flex justify-content-center" style="font-size: small" >
                    <a disabled="@isBusy" href="/auth/LogIn">Sign in</a>
                </div>
            </EditForm>
        </div>
    </div>
</div>


    @code {
        RegisterUserVM model = new RegisterUserVM { IsAdmin = false };
        bool isBusy = false;

        string message = string.Empty;


        public async void RegisterUser()
        {
            isBusy = true;
            if (model.Password == model.PasswordConfirm)
            {
                var modelDTO = _mapper.Map<RegisterUserDTO>(model);
                var response = await Client.PostAsJsonAsync("https://localhost:44397/api/User/Register", modelDTO);

                if (response.IsSuccessStatusCode)
                {

                    NavManager.NavigateTo($"/auth/LogIn");
                }                
            }
            else
            {
                message = "Password is not the same!";
            }
            isBusy = false;
        }
        public void HideMessage()
        {
            message = string.Empty;
        }
    }
